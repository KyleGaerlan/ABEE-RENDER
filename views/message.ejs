<!-- views/message.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Message Us - A.BEE Travel and Tours</title>
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/fontstyle.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #fffdfa;
      margin: 0;
      padding: 0;
    }

    main.message-container {
      max-width: 700px;
      margin: 120px auto 100px;
      padding: 40px;
      background: #ffffff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border-radius: 16px;
      text-align: center;
    }

    main.message-container h1 {
      font-size: 2rem;
      margin-bottom: 25px;
      color: #ff914d;
    }

    form#messageForm {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .form-group {
      text-align: left;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #333;
    }

    select,
    textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
      resize: none;
    }

    select:focus,
    textarea:focus {
      outline: none;
      border-color: #ff914d;
      box-shadow: 0 0 5px rgba(255, 145, 77, 0.4);
    }

    button[type="submit"] {
      background: linear-gradient(90deg, #ff914d, #ffb366);
      border: none;
      color: #fff;
      font-weight: 600;
      padding: 12px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    button[type="submit"]:hover {
      background: linear-gradient(90deg, #ffb366, #ff914d);
      transform: scale(1.03);
    }

    .form-status {
      margin-top: 10px;
      font-weight: 500;
    }

    .form-status.success { color: #3bb273; }
    .form-status.error { color: #e74c3c; }

    @media (max-width: 768px) {
      main.message-container {
        margin: 100px 15px;
        padding: 25px;
      }
      main.message-container h1 {
        font-size: 1.6rem;
      }
    }
    
        .hamburger-menu {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 21px;
            cursor: pointer;
            margin-right: 20px;
            z-index: 1001;
        }

        .hamburger-menu span {
            display: block;
            height: 3px;
            width: 100%;
            background-color: #333;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        /* Responsive styles */
        @media (max-width: 992px) {
            nav ul {
                margin-left: 0;
                padding-right: 20px;
                justify-content: flex-end;
            }
            
            .back-button-wrapper {
                margin-right: auto;
            }
        }

        @media (max-width: 768px) {
            .hamburger-menu {
                display: flex;
                position: absolute;
                right: 20px;
                top: 20px;
            }
            .hero-content .container{
                width: 100%;
                margin-right: auto;
                padding: 5px;
                height: 55vh;
                margin-left: -30px;
                padding-right: 50px;
                padding-left: 30px;
            }
            
            nav ul {
                position: fixed;
                top: 0;
                right: -100%;
                width: 250px;
                background-color: white;
                flex-direction: column;
                padding: 60px 20px 30px; /* Reduced top padding */
                transition: right 0.3s ease;
                box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
                z-index: 1000;
                margin-left: 0;
                align-items: flex-start;
                gap: 15px; /* Reduced gap between items */
                overflow-y: auto;
            }
            
            nav ul.active {
                right: 0;
            }
            
            nav ul li {
                width: 100%;
                margin: 0; /* Remove any margin */
                padding: 0; /* Remove any padding */
            }
            
            nav ul li a, 
            nav ul li button {
                display: block;
                width: 100%;
                padding: 8px 0; /* Reduced padding */
                text-align: left;
                font-size: 16px; /* Slightly smaller font */
            }
            
            #loginBtnWrapper {
                width: auto;
                background: none;
                padding: 0;
            }
            
            #loginBtnWrapper #loginBtn {
                background-color: #f26523;
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
                width: 100%;
                text-align: center;
            }
            
            #profileDropdown,
            #notificationDropdown {
                position: static;
                width: 100%;
                box-shadow: none;
                margin-top: 5px;
                padding: 5px 0;
                border: 1px solid #eee;
                border-radius: 4px;
                background-color: #f9f9f9;
            }
            
            #profileDropdown li,
            #notificationDropdown li {
                padding: 0;
            }
            
            #profileDropdown li a,
            #notificationDropdown li a {
                padding: 8px 15px;
                font-size: 14px;
            }
            
            .overlay-bg {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }
            
            .overlay-bg.active {
                display: block;
            }
            
            /* Hamburger menu animation */
            .hamburger-menu.active span:nth-child(1) {
                transform: translateY(9px) rotate(45deg);
            }
            
            .hamburger-menu.active span:nth-child(2) {
                opacity: 0;
            }
            
            .hamburger-menu.active span:nth-child(3) {
                transform: translateY(-9px) rotate(-45deg);
            }
            
            /* Fix for notification icon */
            .notification-icon {
                width: 20px;
                height: 20px;
            }
            
            /* Fix for profile icon */
            .profile-icon {
                width: 24px;
                height: 24px;
            }
        }  
  </style>
</head>

<body>
  <div class="overlay-bg" id="overlayBg"></div>

  <!-- âœ… HEADER (exactly like index.ejs) -->
  <header>
    <div class="logo">
      <img src="/images/Image-logo.png" alt="Logo">
      <img src="/images/Text-logo.png" alt="Logo">
    </div>

    <div class="top-contact-bar">
      <div class="contact-info">
        <a href="https://www.facebook.com/abeetravelandtours" target="_blank" class="contact-icon">
          <img src="/images/communication.png" alt="Facebook" class="facebook-logo">
        </a>
      </div>
    </div>

  <div class="hamburger-menu">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <nav>
      <ul>
        <!-- âœ… Notification Bell -->
        <li id="notificationWrapper" style="display: none;">
          <a href="javascript:void(0);" id="notificationIcon" class="notification-icon-link">
            <img src="/images/bell.png" alt="Notifications" class="notification-icon">
          </a>
          <ul id="notificationDropdown" class="dropdown-menu" style="display: none;">
            <li><span id="bookingStatus">No new updates at the moment.</span></li>
            <li><a href="/my-bookings" id="checkBookingsLink">View All Bookings</a></li>
          </ul>
        </li>

        <li><a href="/">Home</a></li>
        <li><a href="/#featured-tours">Tours</a></li>
        <li><a href="/#services">Services</a></li>
        <li id="contactNav"><a href="/message">Message</a></li>
        <li><a href="/about">About</a></li>

        <!-- âœ… Login & Profile -->
        <li id="loginBtnWrapper"><button id="loginBtn">Login</button></li>

        <li id="userProfile" style="display: none;">
          <a href="javascript:void(0);" id="profileIconWrapper">
            <img src="/images/profile.png" alt="User Profile" id="profileIcon" class="profile-icon">
          </a>
          <ul id="profileDropdown" class="dropdown-menu" style="display: none;">
            <li><a href="/profile">Profile</a></li>
            <li><a href="/settings">Settings</a></li>
            <li><a href="/logout" id="logoutBtn">Logout</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </header>

  <div class="overlay-bg"></div>

  <!-- ðŸ“¨ MESSAGE FORM -->
  <main class="message-container" data-aos="fade-up">
    <h1>Message Us</h1>

    <% if (!user) { %>
      <div class="login-prompt">
        <p>You must be logged in to send us a message.</p>
        <p><a href="/login">Click here to log in</a></p>
      </div>
    <% } else { %>
<form id="contactForm">
  <!-- Hidden user info -->
  <input type="hidden" id="contactName" value="<%= user.firstName %> <%= user.lastName %>">
  <input type="hidden" id="contactEmail" value="<%= user.email %>">
  <input type="hidden" id="contactPhone" value="<%= user.phone || '' %>">
  <input type="hidden" id="contactCountry" value="<%= user.country || '' %>">

  <!-- Visible fields -->
  <div class="form-group">
    <label for="contactSubject">Subject</label>
    <select id="contactSubject" required>
      <option value="">-- Select a Subject --</option>
      <option value="Booking Inquiry">Booking Inquiry</option>
      <option value="Visa Assistance">Visa Assistance</option>
      <option value="Payment Concern">Payment Concern</option>
      <option value="Travel Package Question">Travel Package Question</option>
      <option value="Other">Other</option>
    </select>
  </div>

  <div class="form-group">
    <label for="contactMessage">Message</label>
    <textarea id="contactMessage" rows="5" placeholder="Write your message here..." required></textarea>
  </div>

  <button type="submit">Send Message</button>
</form>

<p id="contactFormStatus" class="form-status"></p>

    <% } %>
  </main>

  <!-- âœ… FOOTER -->
  <footer class="footer-columns">
    <div class="footer-content">
      <div class="footer-left">
        <h3>Contact Us</h3>
        <p>ðŸ“ž (044) 604 7273</p>
        <p>ðŸ“ž 09361055665</p>
        <p>ðŸ“§ <a href="mailto:abeetravelandtours@gmail.com">abeetravelandtours@gmail.com</a></p>
      </div>
      <div class="footer-right">
        <h3>Follow Us</h3>
        <a href="https://www.facebook.com/abeetravelandtours" target="_blank">
          <img src="/images/communication.png" alt="Facebook" class="social-icon facebook-logo">
        </a>
        <a href="https://www.instagram.com/a.bee_travelandtours/" target="_blank">
          <img src="/images/instagram.png" alt="Instagram" class="social-icon instagram-logo">
        </a>
      </div>
    </div>
    <p class="footer-bottom">Copyright Â© 2025 A.BEE Travel and Tours Website. All rights reserved.</p>
  </footer>

  <script src="/js/java.js"></script>
  
  <script src="/js/contact-form.js"></script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const profileIconWrapper = document.getElementById("profileIconWrapper");
  const profileDropdown = document.getElementById("profileDropdown");

  // âœ… Toggle profile dropdown only
  if (profileIconWrapper && profileDropdown) {
    profileIconWrapper.addEventListener("click", (e) => {
      e.stopPropagation();
      const isVisible = profileDropdown.style.display === "block";
      profileDropdown.style.display = isVisible ? "none" : "block";
    });

    // âœ… Close dropdown when clicking outside
    window.addEventListener("click", (e) => {
      if (
        !profileDropdown.contains(e.target) &&
        !profileIconWrapper.contains(e.target)
      ) {
        profileDropdown.style.display = "none";
      }
    });
  }

  // âœ… Hamburger still works (same as before)
  const hamburger = document.querySelector(".hamburger-menu");
  const navLinks = document.querySelector("nav ul");
  const overlayBg = document.getElementById("overlayBg");

  if (hamburger && navLinks && overlayBg) {
    hamburger.addEventListener("click", () => {
      hamburger.classList.toggle("active");
      navLinks.classList.toggle("active");
      overlayBg.classList.toggle("active");
    });

    overlayBg.addEventListener("click", () => {
      hamburger.classList.remove("active");
      navLinks.classList.remove("active");
      overlayBg.classList.remove("active");
    });
  }
});
</script>

  <script>
    AOS.init({ duration: 800 });
  </script>
  <script>
document.getElementById("contactForm")?.addEventListener("submit", async (e) => {
  e.preventDefault();
  
  const subject = document.getElementById("contactSubject").value;
  const message = document.getElementById("contactMessage").value;
  const statusEl = document.getElementById("contactFormStatus");

  statusEl.textContent = "Sending...";
  statusEl.className = "form-status";

  try {
    const res = await fetch("/contact", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ subject, message })
    });

    const data = await res.json();

    if (data.success) {
      statusEl.textContent = data.message;
      statusEl.classList.add("success");
      e.target.reset();
    } else {
      statusEl.textContent = data.message || "Failed to send message.";
      statusEl.classList.add("error");
    }
  } catch (err) {
    console.error(err);
    statusEl.textContent = "Something went wrong. Please try again later.";
    statusEl.classList.add("error");
  }
});
</script>

</body>
</html>
